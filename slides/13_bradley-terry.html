<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="Prof.&nbsp;Baumer">
  <meta name="dcterms.date" content="2025-10-20">
  <title>SDS 355: Fall 2025 – Bradley-Terry models</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-832775eafbd512325564c8c290c39367.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Bradley-Terry models</h1>
  <p class="subtitle">SDS 355</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Prof.&nbsp;Baumer 
</div>
</div>
</div>

  <p class="date">October 20, 2025</p>
</section>
<section>
<section id="paired-comparison-models" class="title-slide slide level1 center">
<h1>Paired comparison models</h1>

</section>
<section id="bradley1952" class="slide level2">
<h2><span class="citation" data-cites="Bradley1952">Bradley and Terry (<a href="#/references" role="doc-biblioref" onclick="">1952</a>)</span></h2>
<p>Let <span class="math inline">\(A_i, A_j\)</span> be teams. Then</p>
<p><span class="math display">\[
  p_{ij} = \Pr{ \left( A_i \text{ defeats } A_j \right) }
= \frac{\lambda_i}{\lambda_i + \lambda_j}
\]</span> for <strong>unobserved</strong> team strengths <span class="math inline">\(\lambda_i, \lambda_j &gt; 0\)</span>.</p>
</section>
<section id="use-logistic-distribution" class="slide level2">
<h2>Use logistic distribution</h2>
<p>Set <span class="math inline">\(\beta_i = \ln{\lambda_i}\)</span>. Then,</p>
<p><span class="math display">\[
  p_{ij} = \frac{1}{1 + e^{-(\beta_i-\beta_j)}} = F(\beta_i - \beta_j),
\]</span> where <span class="math inline">\(F(x)\)</span> is the CDF of the <a href="https://en.wikipedia.org/wiki/Logistic_distribution">logistic distribution</a> with <span class="math inline">\(\mu = 0, s = 1\)</span>.</p>
</section>
<section id="convert-to-odds" class="slide level2">
<h2>Convert to odds</h2>
<p>Form the <strong>odds</strong>, then the log-odds:</p>
<p><span class="math display">\[\begin{align*}
  \frac{p_{ij}}{1 - p_{ij}}
    &amp;= e^{(\beta_i - \beta_j)} \\
  \ln{\left( \frac{p_{ij}}{1 - p_{ij}} \right)}
    &amp;= \beta_i - \beta_j
\end{align*}\]</span></p>
</section>
<section id="setup-design-matrix" class="slide level2">
<h2>Setup design matrix</h2>
<p>But this is the setup for <a href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a>:</p>
<p><span class="math display">\[\begin{align*}
  \ln{ \left( \frac{p_{ij}}{1 - p_{ij}} \right) }
    &amp;= \beta_i - \beta_j \\
    &amp;= \begin{pmatrix} 0 &amp; 0 &amp; 1 &amp; \cdots &amp; -1 &amp; \cdots &amp; 0 \end{pmatrix} \begin{pmatrix} \beta_1 \\ \vdots \\ \beta_n \end{pmatrix} \\
    &amp;= \vec{X} \cdot \vec{\beta}
\end{align*}\]</span></p>
</section>
<section id="bradleyterry2" class="slide level2">
<h2><code>BradleyTerry2</code></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a></a><span class="fu">library</span>(BradleyTerry2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="footer">
<p><a href="https://www.jstatsoft.org/article/view/v048i09/601" class="uri">https://www.jstatsoft.org/article/view/v048i09/601</a></p>
</div>
</section></section>
<section>
<section id="example-mens-tennis" class="title-slide slide level1 center">
<h1>Example: Men’s tennis</h1>

</section>
<section id="head-to-head-matchups" class="slide level2">
<h2>Head-to-head matchups</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>tennis <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-2"><a></a>  <span class="at">Djokovic =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">9</span>, <span class="dv">14</span>, <span class="dv">9</span>, <span class="dv">4</span>),</span>
<span id="cb2-3"><a></a>  <span class="at">Federer =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="cn">NA</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb2-4"><a></a>  <span class="at">Murray =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb2-5"><a></a>  <span class="at">Nadal =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="cn">NA</span>, <span class="dv">4</span>),</span>
<span id="cb2-6"><a></a>  <span class="at">Wawrinka =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NA</span>)</span>
<span id="cb2-7"><a></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a></a>  BradleyTerry2<span class="sc">::</span><span class="fu">countsToBinomial</span>()</span>
<span id="cb2-10"><a></a>tennis</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    player1  player2 win1 win2
1  Djokovic  Federer    9    6
2  Djokovic   Murray   14    3
3  Djokovic    Nadal    9    2
4  Djokovic Wawrinka    4    3
5   Federer   Murray    5    0
6   Federer    Nadal    5    1
7   Federer Wawrinka    7    2
8    Murray    Nadal    2    4
9    Murray Wawrinka    2    2
10    Nadal Wawrinka    4    3</code></pre>
</div>
</div>
</section>
<section id="fit-the-model" class="slide level2">
<h2>Fit the model</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>btm_tennis <span class="ot">&lt;-</span> BradleyTerry2<span class="sc">::</span><span class="fu">BTm</span>(<span class="fu">cbind</span>(win1, win2), player1, player2, <span class="at">data =</span> tennis)</span>
<span id="cb4-2"><a></a>btm_tennis</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bradley Terry model fit by glm.fit 

Call:  BradleyTerry2::BTm(outcome = cbind(win1, win2), player1 = player1, 
    player2 = player2, data = tennis)

Coefficients:
 ..Federer    ..Murray     ..Nadal  ..Wawrinka  
  -0.04034    -1.74464    -1.23797    -1.17612  

Degrees of Freedom: 10 Total (i.e. Null);  6 Residual
Null Deviance:      26.9 
Residual Deviance: 4.396    AIC: 34.04</code></pre>
</div>
</div>
</section>
<section id="recover-abilities" class="slide level2">
<h2>Recover abilities</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>players <span class="ot">&lt;-</span> btm_tennis <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a></a>  <span class="fu">update</span>(<span class="at">refcat =</span> <span class="st">"Wawrinka"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a></a>  BradleyTerry2<span class="sc">::</span><span class="fu">BTabilities</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Player"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ability))</span>
<span id="cb6-6"><a></a>players</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  Player   ability     s.e.      
  &lt;chr&gt;    &lt;BTabilts&gt;  &lt;BTabilts&gt;
1 Djokovic  1.17612172 0.4995230 
2 Federer   1.13578408 0.5109457 
3 Wawrinka  0.00000000 0.0000000 
4 Nadal    -0.06185141 0.5148698 
5 Murray   -0.56851913 0.5683333 </code></pre>
</div>
</div>
</section>
<section id="visualize-abilities" class="slide level2">
<h2>Visualize abilities</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="fu">ggplot</span>(players, <span class="fu">aes</span>(<span class="at">y =</span> Player, <span class="at">x =</span> ability)) <span class="sc">+</span></span>
<span id="cb8-2"><a></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb8-3"><a></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> ability)) <span class="sc">+</span></span>
<span id="cb8-4"><a></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ability <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>s.e., <span class="at">xmax =</span> ability <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>s.e.), <span class="at">height =</span> <span class="fl">0.25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="13_bradley-terry_files/figure-revealjs/unnamed-chunk-5-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="example-mlb-teams" class="title-slide slide level1 center">
<h1>Example: MLB teams</h1>

</section>
<section id="get-retrosheet-data" class="slide level2">
<h2>Get Retrosheet data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="fu">library</span>(retrosheet)</span>
<span id="cb9-2"><a></a>games <span class="ot">&lt;-</span> <span class="fu">get_retrosheet</span>(<span class="st">"game"</span>, <span class="dv">2024</span>)</span>
<span id="cb9-3"><a></a>games <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a></a>  <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date DblHdr Day VisTm VisTmLg VisTmGNum HmTm HmTmLg HmTmGNum VisRuns
1 2024-03-20      0 Wed   LAN      NL         1  SDN     NL        1       5
2 2024-03-21      0 Thu   SDN      NL         2  LAN     NL        2      15
3 2024-03-28      0 Thu   COL      NL         1  ARI     NL        1       1
4 2024-03-28      0 Thu   WAS      NL         1  CIN     NL        1       2
5 2024-03-28      0 Thu   SLN      NL         1  LAN     NL        3       1
6 2024-03-28      0 Thu   PIT      NL         1  MIA     NL        1       6
  HmRuns NumOuts DayNight Completion Forfeit Protest ParkID Attendance Duration
1      2      54        N       &lt;NA&gt;      NA      NA  SEO01      15952      185
2     11      54        N       &lt;NA&gt;      NA      NA  SEO01      15928      222
3     16      51        N       &lt;NA&gt;      NA      NA  PHO01      49011      157
4      8      51        D       &lt;NA&gt;      NA      NA  CIN09      44030      138
5      7      51        D       &lt;NA&gt;      NA      NA  LOS03      52667      143
6      5      72        D       &lt;NA&gt;      NA      NA  MIA02      32564      204
       VisLine       HmLine VisAB VisH VisD VisT VisHR VisRBI VisSH VisSF
1    000100040    001100000    33    7    0    0     0      4     0     2
2    504011103    114020120    43   18    3    1     1     14     0     2
3    010000000 20(14)00000x    30    4    2    0     0      1     0     0
4    000000200    03400001x    32    6    0    0     1      2     0     0
5    000100000    20300110x    31    3    0    0     1      1     0     0
6 002000210001 022010000000    44    9    2    0     3      6     0     0
  VisHBP VisBB VisIBB VisK VisSB VisCS VisGDP VisCI VisLOB VisPs VisER VisTER
1      1     9      0    7     1     0      0     0     13     5     2      2
2      2     6      0    8     1     0      1     0     11     6    11     11
3      1     3      0    6     0     0      1     0      6     5    16     16
4      0     0      0    9     0     0      0     0      3     5     8      8
5      0     1      0    6     1     0      0     0      4     4     7      7
6      0     8      2   17     0     0      0     0     13     7     4      4
  VisWP VisBalks VisPO VisA VisE VisPassed VisDB VisTP HmAB HmH HmD HmT HmHR
1     1        0    27   11    0         0     1     0   30   4   0   0    0
2     1        0    27   10    0         0     0     0   42  16   3   0    1
3     0        0    24    8    0         0     1     0   40  18   3   0    1
4     0        0    24    5    0         0     0     0   34  10   3   0    2
5     0        0    24    7    0         0     1     0   31  10   2   0    2
6     0        0    36   20    1         0     3     0   41   8   2   0    0
  HmRBI HmSH HmSF HmHBP HmBB HmIBB HmK HmSB HmCS HmGDP HmCI HmLOB HmPs HmER
1     1    0    0     0    4     0   6    0    0     1    0     5    8    3
2    11    0    1     1    6     0   9    0    0     0    0    12    7   14
3    16    0    1     0    3     0   9    0    0     1    0     4    5    1
4     8    0    0     1    2     0   9    3    0     0    0     5    3    2
5     7    0    1     0    4     0  10    0    0     1    0     5    2    1
6     5    0    1     2    4     2   7    1    0     3    0    10    7    5
  HmTER HmWP HmBalks HmPO HmA HmE HmPass HmDB HmTP   UmpHID          UmpHNm
1     3    1       0   27   8   2      0    1    0 barkl901 Lance Barksdale
2    14    2       0   27   7   2      0    1    0 fleta901   Andy Fletcher
3     1    0       0   27  14   0      0    1    0 belld901     Dan Bellino
4     2    0       0   27   8   1      0    0    0 iassd901    Dan Iassogna
5     1    0       0   27   2   1      0    0    0 porta901     Alan Porter
6     5    0       0   36  14   1      0    0    0 guccc901  Chris Guccione
   Ump1BID         Ump1BNm  Ump2BID         Ump2BNm  Ump3BID         Ump3BNm
1 torrc901   Carlos Torres viscj901 Jansen Visconti rehaj901   Jeremie Rehak
2 viscj901 Jansen Visconti rehaj901   Jeremie Rehak barkl901 Lance Barksdale
3 cuzzp901      Phil Cuzzi randt901   Tony Randazzo tosia901       Alex Tosi
4 buckc901      CB Bucknor becka901       Adam Beck may-b901         Ben May
5 blakr901    Ryan Blakney tomln901  Nate Tomlinson barbs901     Sean Barber
6 knigb901    Brian Knight morag901    Gabe Morales addir901    Ryan Additon
  UmpLFID UmpLFNm UmpRFID UmpRFNm VisMgrID       VisMgrNm  HmMgrID      HmMgrNm
1      NA  (none)      NA  (none) robed001   Dave Roberts shilm801  Mike Shildt
2      NA  (none)      NA  (none) shilm801    Mike Shildt robed001 Dave Roberts
3      NA  (none)      NA  (none) blacb001    Buddy Black lovut001 Tony Lovullo
4      NA  (none)      NA  (none) robif103 Frank Robinson belld002   David Bell
5      NA  (none)      NA  (none) marmo801  Oliver Marmol robed001 Dave Roberts
6      NA  (none)      NA  (none) sheld801  Derek Shelton mckej801  Jack McKeon
    WinPID         WinPNm      PID              PNAme  SavePID        SavePNm
1 hudsd001  Daniel Hudson britj003        Jhony Brito phile001  Evan Phillips
2 kingm002   Michael King yamay001 Yoshinobu Yamamoto suarr002  Robert Suarez
3 gallz001     Zac Gallen freek001      Kyle Freeland     &lt;NA&gt;         (none)
4 montf001 Frankie Montas grayj004        Josiah Gray     &lt;NA&gt;         (none)
5 glast001  Tyler Glasnow mikom001      Miles Mikolas yarbr001 Ryan Yarbrough
6 ortil003     Luis Ortiz crond001      Declan Cronin hernj005 Jose Hernandez
  GWinRBIID        GWinRBINm VisStPchID    VisStPchNm HmStPchID
1      &lt;NA&gt;           (none)   glast001 Tyler Glasnow  darvy001
2  cronj001 Jake Cronenworth   musgj001  Joe Musgrove  yamay001
3  gurrl001  Lourdes Gurriel   freek001 Kyle Freeland  gallz001
4  stees001    Spencer Steer   grayj004   Josiah Gray  montf001
5  freef001  Freddie Freeman   mikom001 Miles Mikolas  glast001
6  trioj001     Jared Triolo   kellm003  Mitch Keller  luzaj001
           HmStPchNm VisBat1ID        VisBat1Nm VisBat1Pos VisBat2ID
1         Yu Darvish  bettm001     Mookie Betts          6  ohtas001
2 Yoshinobu Yamamoto  bogax001  Xander Bogaerts          4  tatif002
3         Zac Gallen  blacc001 Charlie Blackmon          9  bryak001
4     Frankie Montas  abrac001     C. J. Abrams          6  thoml002
5      Tyler Glasnow  donob001  Brendan Donovan          7  goldp001
6      Jesus Luzardo  joe-c001       Connor Joe          9  reynb001
         VisBat2Nm VisBat2Pos VisBat3ID        VisBat3Nm VisBat3Pos VisBat4ID
1    Shohei Ohtani         10  freef001  Freddie Freeman          3  smitw003
2   Fernando Tatis          9  cronj001 Jake Cronenworth          3  machm001
3      Kris Bryant          3  jonen002      Nolan Jones          7  rodgb002
4      Lane Thomas          9  winkj002     Jesse Winker          7  menej001
5 Paul Goldschmidt          3  gormn001     Nolan Gorman          4  arenn001
6   Bryan Reynolds          7  hayek001   Ke'Bryan Hayes          5  mccua001
         VisBat4Nm VisBat4Pos VisBat5ID         VisBat5Nm VisBat5Pos VisBat6ID
1       Will Smith          2  muncm001         Max Muncy          5  hernt002
2    Manny Machado         10  kim-h002      Ha-Seong Kim          6  profj001
3  Brendan Rodgers          4  mcmar001      Ryan McMahon          5  diaze005
4     Joey Meneses         10  gallj002        Joey Gallo          3  ruizk001
5    Nolan Arenado          5  contw001 Willson Contreras          2  burla001
6 Andrew McCutchen         10  davih001       Henry Davis          2  cruzo001
          VisBat6Nm VisBat6Pos VisBat7ID      VisBat7Nm VisBat7Pos VisBat8ID
1 Teoscar Hernandez          7  outmj002   James Outman          8  heywj001
2  Jurickson Profar          7  campl002 Luis Campusano          2  wadet002
3        Elias Diaz          2  tovae001 Ezequiel Tovar          6  monte001
4      Keibert Ruiz          2  rosae001  Eddie Rosario          8  vargi001
5     Alec Burleson         10  walkj003  Jordan Walker          9  scotv001
6        Oneil Cruz          6  trioj001   Jared Triolo          4  tellr001
         VisBat8Nm VisBat8Pos VisBat9ID       VisBat9Nm VisBat9Pos HmBat1ID
1    Jason Heyward          9  lux-g001       Gavin Lux          4 bogax001
2       Tyler Wade          5  merrj002 Jackson Merrill          8 bettm001
3 Elehuris Montero         10  doylb001   Brenton Doyle          8 martk001
4  Ildemaro Vargas          5  garcl006     Luis Garcia          4 indij001
5     Victor Scott          8  winnm001      Masyn Winn          6 bettm001
6     Rowdy Tellez          3  taylm002  Michael Taylor          8 arral001
         HmBat1Nm HmBat1Pos HmBat2ID       HmBat2Nm HmBat2Pos HmBat3ID
1 Xander Bogaerts         4 tatif002 Fernando Tatis         9 cronj001
2    Mookie Betts         6 ohtas001  Shohei Ohtani        10 freef001
3     Ketel Marte         4 carrc005 Corbin Carroll         9 gurrl001
4  Jonathan India         4 bensw001    Will Benson         8 encac001
5    Mookie Betts         6 ohtas001  Shohei Ohtani        10 freef001
6     Luis Arraez         4 bellj005      Josh Bell         3 delab001
                      HmBat3Nm HmBat3Pos HmBat4ID          HmBat4Nm HmBat4Pos
1             Jake Cronenworth         3 machm001     Manny Machado        10
2              Freddie Freeman         3 smitw003        Will Smith         2
3              Lourdes Gurriel         7 walkc002  Christian Walker         3
4 Christian Encarnacion-Strand         3 candj002 Jeimer Candelario         5
5              Freddie Freeman         3 smitw003        Will Smith         2
6             Bryan De La Cruz        10 chisj001     Jazz Chisholm         8
  HmBat5ID       HmBat5Nm HmBat5Pos HmBat6ID          HmBat6Nm HmBat6Pos
1 kim-h002   Ha-Seong Kim         6 profj001  Jurickson Profar         7
2 muncm001      Max Muncy         5 hernt002 Teoscar Hernandez         7
3 moreg001 Gabriel Moreno         2 suare001    Eugenio Suarez         5
4 fralj001    Jake Fraley         9 delae003   Elly De La Cruz         6
5 muncm001      Max Muncy         5 hernt002 Teoscar Hernandez         7
6 burgj001    Jake Burger         5 sancj003     Jesus Sanchez         9
  HmBat7ID        HmBat7Nm HmBat7Pos HmBat8ID      HmBat8Nm HmBat8Pos HmBat9ID
1 campl002  Luis Campusano         2 wadet002    Tyler Wade         5 merrj002
2 outmj002    James Outman         8 heywj001 Jason Heyward         9 lux-g001
3 alexb001 Blaze Alexander        10 thoma004   Alek Thomas         8 perdg001
4 stees001   Spencer Steer         7 martn003  Nick Martini        10 stept001
5 outmj002    James Outman         8 heywj001 Jason Heyward         9 lux-g001
6 andet001    Tim Anderson         6 gordn001   Nick Gordon         7 fortn001
          HmBat9Nm HmBat9Pos Additional Acquisition
1  Jackson Merrill         8       &lt;NA&gt;           Y
2        Gavin Lux         4       &lt;NA&gt;           Y
3  Gerardo Perdomo         6       &lt;NA&gt;           Y
4 Tyler Stephenson         2       &lt;NA&gt;           Y
5        Gavin Lux         4       &lt;NA&gt;           Y
6      Nick Fortes         2       &lt;NA&gt;           Y</code></pre>
</div>
</div>
</section>
<section id="refactor-to-matchup-format" class="slide level2">
<h2>Refactor to matchup format</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>bt_games <span class="ot">&lt;-</span> games <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a></a>  <span class="fu">group_by</span>(HmTm, VisTm) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb11-4"><a></a>    <span class="at">home_w =</span> <span class="fu">sum</span>(HmRuns <span class="sc">&gt;</span> VisRuns),</span>
<span id="cb11-5"><a></a>    <span class="at">away_w =</span> <span class="fu">sum</span>(VisRuns <span class="sc">&gt;</span> HmRuns),</span>
<span id="cb11-6"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-8"><a></a>    <span class="at">HmTm =</span> <span class="fu">factor</span>(HmTm),</span>
<span id="cb11-9"><a></a>    <span class="at">VisTm =</span> <span class="fu">factor</span>(VisTm, <span class="at">levels =</span> <span class="fu">levels</span>(HmTm))</span>
<span id="cb11-10"><a></a>  )</span>
<span id="cb11-11"><a></a>bt_games <span class="sc">|&gt;</span></span>
<span id="cb11-12"><a></a>  <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   HmTm [1]
  HmTm  VisTm home_w away_w
  &lt;fct&gt; &lt;fct&gt;  &lt;int&gt;  &lt;int&gt;
1 ANA   ATL        1      2
2 ANA   BAL        1      2
3 ANA   BOS        1      2
4 ANA   CHA        2      1
5 ANA   CLE        0      3
6 ANA   COL        1      2</code></pre>
</div>
</div>
</section>
<section id="fit-the-model-1" class="slide level2">
<h2>Fit the model</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>btm_mlb <span class="ot">&lt;-</span> <span class="fu">BTm</span>(</span>
<span id="cb13-2"><a></a>  <span class="at">outcome =</span> <span class="fu">cbind</span>(home_w, away_w), </span>
<span id="cb13-3"><a></a>  <span class="at">player1 =</span> HmTm, </span>
<span id="cb13-4"><a></a>  <span class="at">player2 =</span> VisTm,</span>
<span id="cb13-5"><a></a>  <span class="at">data =</span> bt_games, </span>
<span id="cb13-6"><a></a>  <span class="at">id =</span> <span class="st">"team"</span></span>
<span id="cb13-7"><a></a>)</span>
<span id="cb13-8"><a></a>btm_mlb</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bradley Terry model fit by glm.fit 

Call:  BTm(outcome = cbind(home_w, away_w), player1 = HmTm, player2 = VisTm, 
    id = "team", data = bt_games)

Coefficients:
 teamARI   teamATL   teamBAL   teamBOS   teamCHA   teamCHN   teamCIN   teamCLE  
 0.70941   0.69153   0.69629   0.46502  -0.58725   0.54370   0.41283   0.70002  
 teamCOL   teamDET   teamHOU   teamKCA   teamLAN   teamMIA   teamMIL   teamMIN  
 0.04109   0.54163   0.59943   0.54586   0.91875   0.04471   0.78905   0.45173  
 teamNYA   teamNYN   teamOAK   teamPHI   teamPIT   teamSDN   teamSEA   teamSFN  
 0.77340   0.69053   0.14522   0.82737   0.38860   0.80329   0.51580   0.49374  
 teamSLN   teamTBA   teamTEX   teamTOR   teamWAS  
 0.55275   0.43825   0.35151   0.30469   0.26591  

Degrees of Freedom: 660 Total (i.e. Null);  631 Residual
Null Deviance:      823.3 
Residual Deviance: 714.2    AIC: 1704</code></pre>
</div>
</div>
</section>
<section id="wrangle-team-strengths" class="slide level2">
<h2>Wrangle team strengths</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>strengths <span class="ot">&lt;-</span> btm_mlb <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a></a>  BradleyTerry2<span class="sc">::</span><span class="fu">BTabilities</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"teamID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ability))</span>
<span id="cb15-5"><a></a>strengths</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 3
   teamID ability    s.e.      
   &lt;chr&gt;  &lt;BTabilts&gt; &lt;BTabilts&gt;
 1 LAN    0.9187506  0.2307869 
 2 PHI    0.8273696  0.2304666 
 3 SDN    0.8032914  0.2300761 
 4 MIL    0.7890511  0.2299159 
 5 NYA    0.7733974  0.2257321 
 6 ARI    0.7094136  0.2294201 
 7 CLE    0.7000213  0.2261616 
 8 BAL    0.6962859  0.2252221 
 9 ATL    0.6915301  0.2294049 
10 NYN    0.6905312  0.2293995 
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="visualize-team-strengths" class="slide level2">
<h2>Visualize team strengths</h2>

<img data-src="13_bradley-terry_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch"></section>
<section id="consolidate-team-names" class="slide level2">
<h2>Consolidate team names</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="co"># Retrosheet teamIDs</span></span>
<span id="cb17-2"><a></a><span class="fu">levels</span>(bt_games<span class="sc">$</span>HmTm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ANA" "ARI" "ATL" "BAL" "BOS" "CHA" "CHN" "CIN" "CLE" "COL" "DET" "HOU"
[13] "KCA" "LAN" "MIA" "MIL" "MIN" "NYA" "NYN" "OAK" "PHI" "PIT" "SDN" "SEA"
[25] "SFN" "SLN" "TBA" "TEX" "TOR" "WAS"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>active_teams <span class="ot">&lt;-</span> Lahman<span class="sc">::</span>Teams <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a></a>  <span class="fu">filter</span>(yearID <span class="sc">==</span> <span class="dv">2024</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a></a>  <span class="fu">select</span>(teamIDretro, name) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">" of Anaheim"</span>))</span>
<span id="cb19-5"><a></a>active_teams</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   teamIDretro                  name
1          ANA    Los Angeles Angels
2          ARI  Arizona Diamondbacks
3          ATL        Atlanta Braves
4          BAL     Baltimore Orioles
5          BOS        Boston Red Sox
6          CHN          Chicago Cubs
7          CHA     Chicago White Sox
8          CIN       Cincinnati Reds
9          CLE   Cleveland Guardians
10         COL      Colorado Rockies
11         DET        Detroit Tigers
12         MIA         Miami Marlins
13         HOU        Houston Astros
14         KCA    Kansas City Royals
15         LAN   Los Angeles Dodgers
16         MIL     Milwaukee Brewers
17         MIN       Minnesota Twins
18         NYN         New York Mets
19         NYA      New York Yankees
20         OAK     Oakland Athletics
21         PHI Philadelphia Phillies
22         PIT    Pittsburgh Pirates
23         SDN      San Diego Padres
24         SEA      Seattle Mariners
25         SFN  San Francisco Giants
26         SLN   St. Louis Cardinals
27         TBA        Tampa Bay Rays
28         TEX         Texas Rangers
29         TOR     Toronto Blue Jays
30         WAS  Washington Nationals</code></pre>
</div>
</div>
</section>
<section id="match-teamids-to-get-colors" class="slide level2">
<h2>Match teamIDs to get colors</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>mlb_colors <span class="ot">&lt;-</span> teamcolors<span class="sc">::</span>teamcolors <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a></a>  <span class="fu">filter</span>(league <span class="sc">==</span> <span class="st">"mlb"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Cleveland Indians"</span>, <span class="st">"Cleveland Guardians"</span>, name)) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a></a>  <span class="fu">left_join</span>(active_teams, <span class="at">by =</span> <span class="fu">join_by</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a></a>  <span class="fu">select</span>(teamIDretro, name, primary, secondary)</span>
<span id="cb21-6"><a></a></span>
<span id="cb21-7"><a></a>mlb_colors <span class="sc">|&gt;</span></span>
<span id="cb21-8"><a></a>  <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  teamIDretro name                 primary secondary
  &lt;chr&gt;       &lt;chr&gt;                &lt;chr&gt;   &lt;chr&gt;    
1 ARI         Arizona Diamondbacks #a71930 #000000  
2 ATL         Atlanta Braves       #ce1141 #13274f  
3 BAL         Baltimore Orioles    #df4601 #000000  
4 BOS         Boston Red Sox       #bd3039 #0d2b56  
5 CHN         Chicago Cubs         #cc3433 #0e3386  
6 CHA         Chicago White Sox    #000000 #c4ced4  </code></pre>
</div>
</div>
</section>
<section id="create-color-palette" class="slide level2">
<h2>Create color palette</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>mlb_pal <span class="ot">&lt;-</span> mlb_colors <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a></a>  <span class="fu">pull</span>(primary) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a></a>  <span class="fu">setNames</span>(mlb_colors<span class="sc">$</span>teamIDretro)</span>
<span id="cb23-4"><a></a></span>
<span id="cb23-5"><a></a>mlb_pal</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ARI       ATL       BAL       BOS       CHN       CHA       CIN       CLE 
"#a71930" "#ce1141" "#df4601" "#bd3039" "#cc3433" "#000000" "#c6011f" "#e31937" 
      COL       DET       HOU       KCA       ANA       LAN       MIA       MIL 
"#333366" "#0c2c56" "#002d62" "#004687" "#ba0021" "#005a9c" "#ff6600" "#0a2351" 
      MIN       NYN       NYA       OAK       PHI       PIT       SDN       SFN 
"#002b5c" "#ff5910" "#003087" "#003831" "#284898" "#fdb827" "#002d62" "#fd5a1e" 
      SEA       SLN       TBA       TEX       TOR       WAS 
"#0c2c56" "#c41e3a" "#092c5c" "#c0111f" "#134a8e" "#ab0003" </code></pre>
</div>
</div>
</section>
<section id="visualize-plot-with-team-colors" class="slide level2">
<h2>Visualize plot with team colors!</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>mlb_plot <span class="sc">+</span></span>
<span id="cb25-2"><a></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mlb_pal)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="13_bradley-terry_files/figure-revealjs/unnamed-chunk-15-1.png" width="960" class="r-stretch"></section>
<section id="collect-standings" class="slide level2">
<h2>Collect standings</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>home <span class="ot">&lt;-</span> bt_games <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a></a>  <span class="fu">group_by</span>(<span class="at">teamID =</span> HmTm) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a></a>  <span class="fu">summarize</span>(<span class="at">W =</span> <span class="fu">sum</span>(home_w), <span class="at">L =</span> <span class="fu">sum</span>(away_w))</span>
<span id="cb26-4"><a></a>away <span class="ot">&lt;-</span> bt_games <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a></a>  <span class="fu">group_by</span>(<span class="at">teamID =</span> VisTm) <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a></a>  <span class="fu">summarize</span>(<span class="at">W =</span> <span class="fu">sum</span>(away_w), <span class="at">L =</span> <span class="fu">sum</span>(home_w))</span>
<span id="cb26-7"><a></a>teams <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(home, away) <span class="sc">|&gt;</span></span>
<span id="cb26-8"><a></a>  <span class="fu">group_by</span>(teamID) <span class="sc">|&gt;</span></span>
<span id="cb26-9"><a></a>  <span class="fu">summarize</span>(<span class="at">W =</span> <span class="fu">sum</span>(W), <span class="at">L =</span> <span class="fu">sum</span>(L)) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a></a>  <span class="fu">mutate</span>(<span class="at">wpct =</span> W <span class="sc">/</span> (W <span class="sc">+</span> L)) <span class="sc">|&gt;</span></span>
<span id="cb26-11"><a></a>  <span class="fu">left_join</span>(strengths, <span class="at">by =</span> <span class="fu">join_by</span>(teamID))</span>
<span id="cb26-12"><a></a>teams</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 6
   teamID     W     L  wpct ability     s.e.      
   &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;BTabilts&gt;  &lt;BTabilts&gt;
 1 ANA       63    99 0.389  0.00000000 0.0000000 
 2 ARI       89    73 0.549  0.70941360 0.2294201 
 3 ATL       89    73 0.549  0.69153014 0.2294049 
 4 BAL       91    71 0.562  0.69628592 0.2252221 
 5 BOS       81    81 0.5    0.46502311 0.2243069 
 6 CHA       41   121 0.253 -0.58724852 0.2397303 
 7 CHN       83    79 0.512  0.54370015 0.2287967 
 8 CIN       77    85 0.475  0.41283278 0.2287729 
 9 CLE       92    69 0.571  0.70002125 0.2261616 
10 COL       61   101 0.377  0.04109128 0.2317572 
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="compare-to-winning-percentage" class="slide level2">
<h2>Compare to winning percentage</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="fu">ggplot</span>(teams, <span class="fu">aes</span>(<span class="at">x =</span> wpct, <span class="at">y =</span> ability)) <span class="sc">+</span></span>
<span id="cb28-2"><a></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> teamID)) <span class="sc">+</span></span>
<span id="cb28-4"><a></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> teamID)) <span class="sc">+</span> </span>
<span id="cb28-6"><a></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mlb_pal)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="13_bradley-terry_files/figure-revealjs/unnamed-chunk-17-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="add-home-field-advantage" class="title-slide slide level1 center">
<h1>Add home field advantage</h1>

</section>
<section id="update-model" class="slide level2">
<h2>Update model</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>bt_games2 <span class="ot">&lt;-</span> bt_games <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a></a>    <span class="at">HmTm =</span> <span class="fu">data.frame</span>(<span class="at">team =</span> HmTm, <span class="at">at_home =</span> <span class="dv">1</span>),</span>
<span id="cb29-4"><a></a>    <span class="at">VisTm =</span> <span class="fu">data.frame</span>(<span class="at">team =</span> VisTm, <span class="at">at_home =</span> <span class="dv">0</span>)</span>
<span id="cb29-5"><a></a>  )</span>
<span id="cb29-6"><a></a></span>
<span id="cb29-7"><a></a>btm2 <span class="ot">&lt;-</span> btm_mlb <span class="sc">|&gt;</span></span>
<span id="cb29-8"><a></a>  <span class="fu">update</span>(<span class="at">formula =</span> <span class="sc">~</span> team <span class="sc">+</span> at_home, <span class="at">data =</span> bt_games2)</span>
<span id="cb29-9"><a></a>btm2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bradley Terry model fit by glm.fit 

Call:  BTm(outcome = cbind(home_w, away_w), player1 = HmTm, player2 = VisTm, 
    formula = ~team + at_home, id = "team", data = bt_games2)

Coefficients:
 teamARI   teamATL   teamBAL   teamBOS   teamCHA   teamCHN   teamCIN   teamCLE  
 0.71120   0.69189   0.69644   0.46507  -0.58941   0.54440   0.41282   0.70089  
 teamCOL   teamDET   teamHOU   teamKCA   teamLAN   teamMIA   teamMIL   teamMIN  
 0.04089   0.54217   0.59957   0.54641   0.91924   0.04430   0.79029   0.45229  
 teamNYA   teamNYN   teamOAK   teamPHI   teamPIT   teamSDN   teamSEA   teamSFN  
 0.77469   0.69055   0.14453   0.82886   0.38841   0.80478   0.51603   0.49465  
 teamSLN   teamTBA   teamTEX   teamTOR   teamWAS   at_home  
 0.55351   0.43829   0.35138   0.30462   0.26562   0.09057  

Degrees of Freedom: 660 Total (i.e. Null);  630 Residual
Null Deviance:      823.3 
Residual Deviance: 709.4    AIC: 1701</code></pre>
</div>
</div>
</section>
<section id="collect-abilities" class="slide level2">
<h2>Collect abilities</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>strengths_ha <span class="ot">&lt;-</span> btm2 <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a></a>  BradleyTerry2<span class="sc">::</span><span class="fu">BTabilities</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"teamID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ability))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="visualize-team-strengths-1" class="slide level2">
<h2>Visualize team strengths</h2>

<img data-src="13_bradley-terry_files/figure-revealjs/unnamed-chunk-20-1.png" width="960" class="r-stretch"></section>
<section id="read-more" class="slide level2">
<h2>Read more!</h2>
<p><span class="citation" data-cites="Lopez2018">Lopez, Matthews, and Baumer (<a href="#/references" role="doc-biblioref" onclick="">2018</a>)</span></p>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Bradley1952" class="csl-entry" role="listitem">
Bradley, Ralph Allan, and Milton E. Terry. 1952. <span>“Rank Analysis of Incomplete Block Designs: I. The Method of Paired Comparisons.”</span> <em>Biometrika</em> 39 (3/4): 324–45. <a href="https://doi.org/10.2307/2334029">https://doi.org/10.2307/2334029</a>.
</div>
<div id="ref-Lopez2018" class="csl-entry" role="listitem">
Lopez, Michael J, Gregory J Matthews, and Benjamin S Baumer. 2018. <span>“How Often Does the Best Team Win? A Unified Approach to Understanding Randomness in <span>North American</span> Sport.”</span> <em>The Annals of Applied Statistics</em> 12 (4): 2483–2516. <a href="https://doi.org/10.1214/18-aoas1165">https://doi.org/10.1214/18-aoas1165</a>.
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="https://github.com/SmithCollege-SDS/sds/raw/master/man/figures/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>SDS 355</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/beanumber\.github\.io\/sds355\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>